@model EFood.Modelos.Producto

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <img src="@Model.UbicacionImagen" alt="Imagen del producto" class="img-fluid" />
        </div>
        <div class="col-md-6">
            <h2>Producto: @Model.Nombre</h2>
            <p>Contenido: @Model.Contenido</p>

            <div>
                <h4>Precios:</h4>
                <div>
                    <input type="radio" name="precio" value="normal" id="precio_normal" checked />
                    <label for="precio_normal">Normal - @Model.Monto</label>
                </div>
                @if (Model.TipoPrecios != null && Model.TipoPrecios.Any())
                {
                    @foreach (var precio in Model.TipoPrecios)
                    {
                        <div>
                            <input type="radio" name="precio" value="@precio" id="precio_@precio.Id" />
                            <label for="precio_@precio.Id">@precio.Descripcion - @precio.Monto</label>
                        </div>
                    }
                }
            </div>

            <div class="form-group">
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" class="form-control" min="1" value="1" />
            </div>

            <form id="carritoForm" method="get" asp-controller="CarritoCompra" asp-action="Agregar">
                <input type="hidden" id="productoId" name="productoId" value="@Model" />
                <input type="hidden" id="cantidadInput" name="cantidad" value="1" />
                <input type="hidden" id="precioSeleccionado" name="tipoPrecio" value="null" />
                <button type="submit" class="btn btn-primary mt-3" onclick="agregarCarrito()">Agregar</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById("carritoForm").addEventListener("submit", function (event) {
            var cantidad = document.getElementById("cantidad").value;
            var precioSeleccionado = document.querySelector('input[name="precio"]:checked').value;
            document.getElementById("cantidadInput").value = cantidad;
            document.getElementById("precioSeleccionado").value = precioSeleccionado;
        });
    </script>

    <script>
        function agregarCarrito() {
            var url = window.location.href; // Obtiene la URL actual
            var id = url.substring(url.lastIndexOf('/') + 1); // Extrae el ID de la URL
            window.location.href = '@Url.Action("Agregar", "CarritoCompra", new { id = "__id__" })'.replace('__id__', id);
        }
    </script>
}
